#+TITLE: fslx
#+AUTHOR: Daniel Gomez
#+DATE: 14.12.2016

/fslx/ is a *dumb* wrapper around some of fsltools. It exists so I don't have to
remember the arbitrary names of fsl tools, nor the parameter naming
conventions of each of them.
There are probably thousands of tools like this one out there, but they weren't on
my search engine's top 3, so I had to write my own.

** Syntax

The usage syntax is the same for all operations:
~fslx op img1~

Or, if you want to process multiple files simultaneously:
~fslx op img1 img2 img3 ...~

Exceptions to the rule are simple to remember though, such as in the case of realignment:
#+BEGIN_SRC bash
fslx reg reference img1 img2 img3
#+END_SRC
And in the case of merging files, where FSLX does exactly what you would expect.


To make things even dummer, operations have alias so that you can type synonyms
and things just work. Alignment, for example, can be called with any of ~reg|align|register~.

** Supported operations

As of yet, FSLX supports the following:

| Operation                | Effect                             | Pipeable | Original FSL operation |
|--------------------------+------------------------------------+----------+------------------------|
| tmean                    | Compute temporal mean              | yes      | fslmaths -Tmean        |
| tstd                     | Compute temporal std               | yes      | fslmaths -Tstd         |
| tsnr                     | Compute temporal tsnr              | yes      | fslmaths mean -div std |
| moco or mc               | Motion correction                  | yes      | mcflirt                |
| brain or rmskull or bet  | Remove skull                       | yes      | bet                    |
| merge or tmerge          | Merge 2D -> or 3D -> 4D            | yes      | fslmerge               |
| split or tsplit          | Split 4D image into multiple 3D    | no yet   | fslsplit               |
| align or register or reg | Align image to reference           | yes      | flirt                  |
| smooth2 , 3 , 4 , 5      | Smooth image with a 2,3,4,5 kernel | yes      | fslmaths -s            |
| nan or nans              | image(image==nan) = 0              | yes      | fslmaths -nan          |
| exp                      | Compute e^image                    | yes      | fslmaths -exp          |
| sin                      | Compute sin(image)                 | yes      | fslmaths -sin          |
| abs or mag or magn       | Compute abs(image)                 | yes      | fslmaths -abs          |
| bin                      | image(image>0) ? 1 : 0             | yes      | fslmaths -bin          |
| recip                    | 1/image, voxelwise                 | yes      | fslmaths -recip        |
| header or hd             | Read image header                  | no       | fslhd                  |
| nvols                    | Query number of volumes in image   | no       | fslnvols               |

Coming soon, hopefully: temporal filtering, segmentation with FAST, ICA, smart registration to MNI152.

** Piping commands
You can use xargs to build a nice easy processing pipeline. Most operations are supported.
Example - motion correct, compute the tSNR, and remove NaNs of all 4D niftis in a directory:
~ls | xargs flsx moco | xargs fslx tsnr | xargs fslx nan~

For maximum efficiency, you can alias ~xargs fslx~:
#+BEGIN_SRC bash
alias xfslx='xargs fslx '
ls | xflsx moco | xfslx tsnr | xfslx nan
#+END_SRC
And then call the pipe with less verbosity.

Note: you get all of your intermediate results, so much sure you have enough disk space.

** Installation
Put fslx on your PATH.

#+BEGIN_SRC bash
git clone https://github.com/dangom/fslx.git
chmod +x fslx/fslx
currdir=`pwd`
echo 'export "PATH='$currdir'/fslx/:$PATH"' >> ~/.bashrc
#+END_SRC

** Dependencies
- FSL
- A Unix like environment with a sane shell available (Linux / MacOS).

** TO DO
- Support for applyxfm, registration to MNI, concatenate transformation matrices.
- FAST segmentation
- Support for Melodic ICA.
- Add support for dual_regression
- Add support for mixture modelling.
- Read from STDIN?

** Why?
Pick one that suits you:

- Nipype takes too many lines of code and I have a PhD to finish.
- The lack of sleep makes me forget fsl commands, and the Wiki doesn't see much loving.
- FSL has decent defaults and 99% of the times I don't need to customize anything.


* Thanks
The awesome [[https://fsl.fmrib.ox.ac.uk/fsl/fslwiki][FSL]].
The poweful BASH.

* Disclaimer

This tool is not a part of FSL. Use at your own risk.
